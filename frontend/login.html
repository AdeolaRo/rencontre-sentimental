<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentimental - Connexion</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-page">
    <div class="login-container">
        <div class="login-header">
            <i class="fas fa-heart"></i>
            <h1>Sentimental</h1>
            <p>Rencontres authentiques et sécurisées</p>
        </div>
        
        <div class="login-form">
            <h2>Connexion</h2>
            <div class="form-group">
                <input type="email" id="loginEmail" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="password" id="loginPassword" placeholder="Mot de passe" required>
            </div>
            <button class="btn btn-primary btn-block" id="loginBtn">Se connecter</button>
            
            <div class="divider">
                <span>ou</span>
            </div>
            
            <button class="btn btn-secondary btn-block" id="showRegisterBtn">Créer un compte</button>
        </div>
        
        <div class="register-form" style="display: none;">
            <h2>Inscription</h2>
            <div class="form-group">
                <input type="email" id="registerEmail" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="password" id="registerPassword" placeholder="Mot de passe" required>
            </div>
            <div class="form-group">
                <input type="text" id="firstName" placeholder="Prénom" required>
            </div>
            <div class="form-group">
                <input type="text" id="lastName" placeholder="Nom" required>
            </div>
            <div class="form-group">
                <input type="date" id="birthDate" required>
            </div>
            <div class="form-group">
                <select id="gender" required>
                    <option value="">Genre</option>
                    <option value="homme">Homme</option>
                    <option value="femme">Femme</option>
                    <option value="autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <input type="text" id="city" placeholder="Ville" required>
            </div>
            <div class="form-group">
                <input type="text" id="department" placeholder="Département (ex: 75)" required>
            </div>
            <div class="form-group">
                <input type="text" id="title" placeholder="Titre de votre annonce" required>
            </div>
            <div class="form-group">
                <textarea id="description" placeholder="Description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <input type="text" id="secretQuestion" placeholder="Question secrète (ex: animal préféré?)" required>
            </div>
            <div class="form-group">
                <input type="text" id="secretAnswer" placeholder="Réponse secrète" required>
            </div>
            
            <button class="btn btn-primary btn-block" id="registerBtn">S'inscrire</button>
            <button class="btn btn-secondary btn-block" id="showLoginBtn">Déjà un compte ?</button>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script>
        // Fonction de notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                animation-fill-mode: forwards;
            `;
            
            // Ajouter les animations CSS si elles n'existent pas déjà
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            // Supprimer après 3 secondes
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Toggle forms
        document.getElementById('showRegisterBtn').addEventListener('click', function() {
            document.querySelector('.login-form').style.display = 'none';
            document.querySelector('.register-form').style.display = 'block';
        });
        document.getElementById('showLoginBtn').addEventListener('click', function() {
            document.querySelector('.register-form').style.display = 'none';
            document.querySelector('.login-form').style.display = 'block';
        });

        // Login
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = await Auth.login(email, password);
            if (result.success) {
                window.location.href = 'index.html';
            } else {
                showNotification(result.error, 'error');
            }
        });

        // Register
        document.getElementById('registerBtn').addEventListener('click', async function() {
            const userData = {
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                birthDate: document.getElementById('birthDate').value,
                gender: document.getElementById('gender').value,
                city: document.getElementById('city').value,
                department: document.getElementById('department').value,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                secretQuestion: document.getElementById('secretQuestion').value,
                secretAnswer: document.getElementById('secretAnswer').value,
                // Champs optionnels, on peut les laisser vides
                emploi: '',
                looking_for: 'rencontres',
                taille: '',
                enfant: 'non',
                alcool: 'occasionnellement',
                cigarette: 'jamais',
                sexualite: '',
                animaux: '',
                centre_interet: ''
            };
            
            try {
                const data = await API.register(userData);
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify({ id: data.userId, email: userData.email, firstName: userData.firstName }));
                window.location.href = 'index.html';
            } catch (e) {
                showNotification(e.message, 'error');
            }
        });
    </script>
</body>
</html>